<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MatchDay</title>
  <link rel="stylesheet" href="view_users_style.css" />
  <link rel="stylesheet" href="resHome.css" />
  <style>
     #notifPopup button {
        background-color: #6e7aff;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.2s;
}
    .notif {
         
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px;
      border-radius: 4px;
    }
    .unread {
      background-color: #e8f4ff;
    }
  </style>
</head>
<header>
  <h1></h1>
   <nav>
    
    <a href="report.html">Report
      <img src = "images/reportsRes_AnnounceASBtn.PNG" alt = "Icon", style="height:36px; vertical-align: middle; margin-right: 5px;"> </a>
    <a href="events.html">Events
      <img src = "images/idkBtn.PNG" alt = "Icon", style="height:36px; vertical-align: middle; margin-right: 5px;"> 
    </a>
    <a href="dashboard.html">
       Bookings
      <img src = "images/bookings_res_manageASBtn.PNG" alt = "Icon", style="height:36px; vertical-align: middle; margin-right: 5px;">
    

  </nav>
</header> 


<body>
  <h1>Your Notifications</h1>
  <div id="notifContainer">Loadingâ€¦</div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const container = document.getElementById('notifContainer');
      const uid = localStorage.getItem('user_uid'); // Must be stored after login

      if (!uid) {
        container.innerHTML = '<p>Please sign in to view your notifications.</p>';
        return;
      }

      try {
        const res = await fetch(`https://backend-k52m.onrender.com/notifications/${uid}`);
        if (!res.ok) throw new Error('Server error: ' + res.statusText);

        const notifications = await res.json();

        if (!notifications.length) {
          container.innerHTML = '<p>No notifications found.</p>';
          return;
        }

        container.innerHTML = '';
        notifications.forEach(n => {
          const div = document.createElement('div');
          div.className = 'notif' + (n.read === false ? ' unread' : '');
          const date = n.created_at?._seconds
            ? new Date(n.created_at._seconds * 1000).toLocaleString()
            : 'No timestamp';

          div.innerHTML = `
            <p>${n.message}</p>
            <small>${date}</small>
          `;
          container.appendChild(div);
        });

      } catch (err) {
        console.error(err);
        container.innerHTML = `<p style="color:red">Error: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
